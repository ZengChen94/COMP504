package model;

import java.awt.Color;
import java.awt.Component;
import java.awt.Graphics;
import java.awt.Point;
import java.util.Observable;
import java.util.Observer;

/**
 * The concrete ball class
 * 
 * @author Yue Pan
 * @author Zihan Wang
 * @version 1.0
 * 
 */
public class CBall implements Observer {

	/**
	 * The location of this ball, which is the center of the ball
	 */
	Point loc;

	/**
	 * The radius of the ball
	 */
	int rad;

	/**
	 * The color of the ball
	 */
	Color color;

	/**
	 * The vel of the ball
	 */
	Point vel;

	/**
	 * The canvas
	 */
	Component canvas;

	/**
	 * The new strategy of the ball.
	 */
	private IUpdateStrategy strategy;

	/**
	 * Constructor for this Ball.
	 * @param _iniLoc The location of this Ball. The location represents the center point.
	 * @param _iniRad The radius of this Ball.
	 * @param _iniVel The velocity of this Ball.
	 * @param _iniColor The Color of this Ball.
	 * @param _canvas The Canvas related to this Ball
	 * @param _iUpdateStrategy The update strategy of the Ball.
	 */
	public CBall(Point _iniLoc, int _iniRad, Point _iniVel, Color _iniColor, Component _canvas,
			IUpdateStrategy _iUpdateStrategy) {
		this.loc = _iniLoc;
		this.rad = _iniRad;
		this.vel = _iniVel;
		this.color = _iniColor;
		this.canvas = _canvas;
		this.strategy = _iUpdateStrategy;
	}

	/**
	 *The bounce method when the ball reach the edge
	 */
	void bounce() {
		/*
		 * The ball reach the left
		 */
		if (loc.x - rad < 0) {
			vel.x *= -1;
			loc.x = rad * 2 - loc.x;
		}

		if (loc.y - rad < 0) {
			vel.y *= -1;
			loc.y = rad * 2 - loc.y;
		}

		if (loc.x + rad > canvas.getWidth()) {
			vel.x *= -1;
			loc.x = 2 * (canvas.getWidth() - rad) - loc.x;
		}

		if (loc.y + rad > canvas.getHeight()) {
			vel.y *= -1;
			loc.y = 2 * (canvas.getHeight() - rad) - loc.y;
		}
	}

	/**
	 * Update the properties of this ABall every time slice.
	 */
	@Override
	public void update(Observable o, Object arg) {
		strategy.updateState(this);
		movingball();
		paint((Graphics) arg);
	}

	/**
	 * The movement of the ball
	 */
	void movingball() {
		move();
		bounce();
	}

	/**
	 * Change the loc of the ball
	 */
	void move() {
		loc.x += vel.x;
		loc.y += vel.y;
	}

	/**
	 * Paint this Ball.
	 * @param g The Graphics object to paint.
	 */
	public void paint(Graphics g) {
		g.setColor(color);
		g.fillOval(loc.x - rad, loc.y - rad, rad * 2, rad * 2);
	}

	/**
	 * set the ball color
	 * @param color 
	 */
	public void setColor(Color color) {
		this.color = color;
	}

	/**
	 * Set the ball radius
	 * @param radius The radius of this Ball.
	 */
	public void setRadius(int radius) {
		this.rad = radius;
	}

	/**
	 * Get ball velocity which is used for update velocity
	 * @return velocity
	 */
	public Point getVel() {
		return this.vel;
	}
}
